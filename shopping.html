<div class="shopping">
  <h2>üõí Shopping List</h2>
  <input type="text" id="shoppingInput" placeholder="Enter item" />
  <button onclick="addItem()">Add</button>

  <h3>üìù Active Items</h3>
  <ul id="activeList"></ul>

  <button onclick="toggleCompleted()">Show/Hide Completed</button>
  <div id="completedSection" style="display:none;">
    <h3>‚úÖ Completed Items</h3>
    <ul id="completedList"></ul>
  </div>
</div>

<script>
  const db = firebase.firestore();

  // Load shopping items
  function loadShoppingList() {
    const activeList = document.getElementById('activeList');
    const completedList = document.getElementById('completedList');
    activeList.innerHTML = "";
    completedList.innerHTML = "";

    db.collection('shopping').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
      activeList.innerHTML = "";
      completedList.innerHTML = "";
      let activeIndex = 1;
      let completedIndex = 1;

      snapshot.forEach(doc => {
        const item = doc.data();
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="checkbox" ${item.completed ? "checked" : ""} onclick="toggleComplete('${doc.id}', ${!item.completed})">
          <span>${item.text}</span>
          <button onclick="editItem('${doc.id}', '${item.text}')">‚úèÔ∏è Edit</button>
        `;

        if (item.completed) {
          li.querySelector('span').style.textDecoration = "line-through";
          completedList.appendChild(li);
        } else {
          activeList.appendChild(li);
        }
      });
    });
  }

  // Add new item
  function addItem() {
    const input = document.getElementById('shoppingInput');
    const text = input.value.trim();
    if (text) {
      db.collection('shopping').add({
        text: text,
        completed: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        input.value = "";
      });
    }
  }

  // Toggle complete status
  function toggleComplete(id, completed) {
    db.collection('shopping').doc(id).update({ completed: completed });
  }

  // Edit item
  function editItem(id, oldText) {
    const newText = prompt("Edit item:", oldText);
    if (newText !== null && newText.trim() !== "") {
      db.collection('shopping').doc(id).update({ text: newText.trim() });
    }
  }

  // Show/Hide completed
  function toggleCompleted() {
    const section = document.getElementById('completedSection');
    section.style.display = section.style.display === "none" ? "block" : "none";
  }

  loadShoppingList();
</script>
