<div class="todo">
  <h2>‚úÖ To-Do List</h2>
  <input type="text" id="todoInput" placeholder="Enter task" />
  <button onclick="addTask()">Add</button>

  <h3>üìù Active Tasks</h3>
  <ul id="activeTasks"></ul>

  <button onclick="toggleCompletedTasks()">Show/Hide Completed</button>
  <div id="completedTasksSection" style="display:none;">
    <h3>‚úÖ Completed Tasks</h3>
    <ul id="completedTasks"></ul>
  </div>
</div>

<script>
  const db = firebase.firestore();

  // Load tasks
  function loadTasks() {
    const activeTasks = document.getElementById('activeTasks');
    const completedTasks = document.getElementById('completedTasks');
    activeTasks.innerHTML = "";
    completedTasks.innerHTML = "";

    db.collection('todo').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
      activeTasks.innerHTML = "";
      completedTasks.innerHTML = "";
      let activeIndex = 1;
      let completedIndex = 1;

      snapshot.forEach(doc => {
        const task = doc.data();
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="checkbox" ${task.completed ? "checked" : ""} onclick="toggleTaskComplete('${doc.id}', ${!task.completed})">
          <span>${task.text}</span>
          <button onclick="editTask('${doc.id}', '${task.text}')">‚úèÔ∏è Edit</button>
        `;

        if (task.completed) {
          li.querySelector('span').style.textDecoration = "line-through";
          completedTasks.appendChild(li);
        } else {
          activeTasks.appendChild(li);
        }
      });
    });
  }

  // Add new task
  function addTask() {
    const input = document.getElementById('todoInput');
    const text = input.value.trim();
    if (text) {
      db.collection('todo').add({
        text: text,
        completed: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        input.value = "";
      });
    }
  }

  // Toggle complete status
  function toggleTaskComplete(id, completed) {
    db.collection('todo').doc(id).update({ completed: completed });
  }

  // Edit task
  function editTask(id, oldText) {
    const newText = prompt("Edit task:", oldText);
    if (newText !== null && newText.trim() !== "") {
      db.collection('todo').doc(id).update({ text: newText.trim() });
    }
  }

  // Show/Hide completed
  function toggleCompletedTasks() {
    const section = document.getElementById('completedTasksSection');
    section.style.display = section.style.display === "none" ? "block" : "none";
  }

  loadTasks();
</script>
